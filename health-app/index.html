<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Yaar AI Companion</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- React and ReactDOM CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel Standalone for JSX transformation in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Firebase SDKs -->
    <script type="module">
        // Import Firebase modules from CDN
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signOut, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Expose Firebase functions globally for the React script to use (as React is embedded directly via Babel)
        window.firebase = {
            initializeApp,
            getAuth,
            signInAnonymously,
            onAuthStateChanged,
            signOut,
            signInWithCustomToken,
            getFirestore,
            doc,
            setDoc,
            getDoc,
            setLogLevel
        };


        // Define global variables for Firebase config and app ID, which will be provided by the Canvas environment.
        // These are accessed by the React code.
        // window.__firebase_config = typeof __firebase_config !== 'undefined' ? __firebase_config : '{}';
        // window.__app_id = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        // window.__initial_auth_token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : '';

        // IMPORTANT: For local testing, replace this with YOUR actual Firebase project configuration.
        // Get this from your Firebase Console -> Project settings -> Your apps -> Web app setup.
        
        window.__firebase_config = JSON.stringify({
          apiKey: "AIzaSyB1hrFsLEKYB4S3uu-4ODLxvupXauj49Ls",
          authDomain: "health-app-8ca1c.firebaseapp.com",
          projectId: "health-app-8ca1c",
          storageBucket: "health-app-8ca1c.firebasestorage.app",
          messagingSenderId: "534257023718",
          appId: "1:534257023718:web:648a3cd42130d29a1e9927",
        //   measurementId: "G-NS7SGCP4ZZ"
        });
        // For local testing, you can use your projectId as appId, or keep the default.
        window.__app_id = typeof __app_id !== 'undefined' ? __app_id : 'your-project-id'; 
        window.__initial_auth_token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : '';
    </script>
    <style>
        /* Custom font for the entire body, falling back to sans-serif */
        body {
            font-family: 'Poppins', sans-serif;
            @apply bg-slate-50 text-gray-800; /* Apply default Tailwind background and text color */
            min-height: 100vh; /* Ensure body takes full viewport height */
        }
        
        /* Keyframe animation for the background gradient in the hero section */
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Custom scrollbar for better aesthetics, applied globally to elements that overflow */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px; /* For horizontal scrollbars if needed */
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Styles specific to scrollable chat area */
        .custom-scrollbar {
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: #888 #f1f1f1; /* Firefox */
        }
    </style>
</head>
<body class="bg-slate-50 text-gray-800">
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

    <script type="text/babel">
        // Destructure React hooks from the global React object
        const { useState, useEffect, useCallback, useRef } = React;
        // Destructure Firebase functions from the global window.firebase object
        const { initializeApp, getAuth, signInAnonymously, onAuthStateChanged, signOut, signInWithCustomToken, getFirestore, doc, setDoc, getDoc, setLogLevel } = window.firebase;

        // --- Notification Component (for showing success/error messages) ---
        const Notification = ({ message, type, show }) => {
            if (!show) return null;
            return (
                <div className={`fixed top-5 right-5 z-50 p-4 rounded-lg shadow-lg text-white max-w-xs transition-all duration-300 transform ${
                    type === 'success' ? 'bg-green-500' : 'bg-red-500'
                } translate-x-0 opacity-100`}>
                    {message}
                </div>
            );
        };


        // --- AI Chatbot Component ---
        const AiChatbot = ({ biodata, isVisible, onClose }) => {
            const [messages, setMessages] = useState([
                { role: 'bot', text: "Hello! I'm the Health Yaar AI assistant. How can I help you today? You can ask me general health questions." }
            ]);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const messagesEndRef = useRef(null);

            // Scrolls messages to the bottom when new messages arrive
            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            // Effect to scroll to bottom whenever messages state changes
            useEffect(scrollToBottom, [messages]);

            // Handles sending a message to the AI
            const handleSendMessage = async () => {
                if (!input.trim() || isLoading) return; // Prevent sending empty messages or multiple messages while loading

                const userMessage = { role: 'user', text: input };
                setMessages(prev => [...prev, userMessage]); // Add user message to chat history
                setInput(''); // Clear input field
                setIsLoading(true); // Set loading state

                // Construct prompt for the AI, including user's biodata for context
                const prompt = `You are a friendly and helpful AI health assistant called "Health Yaar AI". A user is asking a question.
                Here is some of their health data for context (use it to provide more relevant, general advice but do not diagnose):
                - Chronic Conditions: ${biodata.chronicDiseases || 'Not provided'}
                - Allergies: ${biodata.allergies || 'Not provided'}
                - Dietary Habits: ${biodata.dietaryHabits || 'Not provided'}

                The user's question is: "${userMessage.text}"

                Please provide a helpful, safe, and general response.
                *IMPORTANT*: Do NOT provide a medical diagnosis or prescribe medication. Always include a disclaimer to consult a healthcare professional for personal medical advice.
                `;

                try {
                    const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                    const payload = { contents: chatHistory };
                    const apiKey = ""; // Canvas environment provides this key at runtime
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    
                    // Make the API call to Gemini
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json(); // Parse the JSON response

                    let botResponseText = "I'm having trouble connecting right now. Please try again later.";
                    // Check if the response structure is valid and extract the text
                    if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                        botResponseText = result.candidates[0].content.parts[0].text;
                    }

                    // Add bot's response to chat history
                    setMessages(prev => [...prev, { role: 'bot', text: botResponseText }]);
                } catch (error) {
                    console.error("Gemini API error:", error);
                    setMessages(prev => [...prev, { role: 'bot', text: "Sorry, I encountered an error. Please check your connection and try again." }]);
                } finally {
                    setIsLoading(false); // End loading state
                }
            };

            // If chatbot is not visible, return null to not render it
            if (!isVisible) return null;

            return (
                <div className="fixed bottom-20 right-5 w-full max-w-md md:max-w-lg h-[calc(100vh-10rem)] bg-white rounded-xl shadow-2xl flex flex-col z-30 transition-all duration-300 border border-gray-200">
                    {/* Chatbot Header */}
                    <div className="p-4 bg-gradient-to-r from-blue-600 to-indigo-700 text-white rounded-t-xl flex justify-between items-center shadow-md">
                        <h3 className="font-bold text-lg md:text-xl">AI Doctor Chatbot</h3>
                        {/* Close button for the chatbot */}
                        <button onClick={onClose} className="text-2xl leading-none font-semibold p-1 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors">&times;</button>
                    </div>
                    {/* Chat Messages Area */}
                    <div className="flex-1 p-4 overflow-y-auto bg-gray-50 custom-scrollbar">
                        {messages.map((msg, index) => (
                            <div key={index} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'} mb-3`}>
                                <div className={`py-2 px-4 rounded-2xl max-w-[80%] break-words ${
                                    msg.role === 'user' ? 'bg-blue-500 text-white shadow-md' : 'bg-gray-200 text-gray-800 shadow-sm'
                                }`}>
                                    {msg.text}
                                </div>
                            </div>
                        ))}
                        {/* Loading indicator for bot response */}
                        {isLoading && (
                            <div className="flex justify-start mb-3">
                                <div className="py-2 px-4 rounded-2xl bg-gray-200 text-gray-800 shadow-sm">
                                    <span className="animate-pulse">Typing...</span>
                                </div>
                            </div>
                        )}
                        <div ref={messagesEndRef} /> {/* Ref for auto-scrolling */}
                    </div>
                    {/* Message Input Area */}
                    <div className="p-4 border-t border-gray-200 bg-white">
                        <div className="flex">
                            <input
                                type="text"
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
                                className="flex-1 p-3 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all text-gray-700"
                                placeholder="Ask a health question..."
                                disabled={isLoading}
                            />
                            <button 
                                onClick={handleSendMessage} 
                                disabled={isLoading || !input.trim()} 
                                className="bg-blue-600 text-white px-5 rounded-r-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed shadow-md transition-colors"
                            >
                                Send
                            </button>
                        </div>
                    </div>
                </div>
            );
        };


        // --- Main App Component ---
        const App = () => {
            // --- State Management ---
            const [auth, setAuth] = useState(null); // Firebase Auth instance
            const [db, setDb] = useState(null);     // Firebase Firestore instance
            const [userId, setUserId] = useState(null); // Current authenticated user ID
            const [isAuthReady, setIsAuthReady] = useState(false); // Flag for Firebase auth readiness
            const [notification, setNotification] = useState({ show: false, message: '', type: '' }); // Global notification state
            const [isChatbotVisible, setIsChatbotVisible] = useState(false); // Chatbot visibility state
            const [healthSummary, setHealthSummary] = useState(''); // Stores AI-generated health summary
            const [isSummaryLoading, setIsSummaryLoading] = useState(false); // Loading state for summary generation
            const [reportAnalysis, setReportAnalysis] = useState(''); // Stores AI-generated report analysis
            const [isReportLoading, setIsReportLoading] = useState(false); // Loading state for report analysis
            const [reportImage, setReportImage] = useState(null); // Holds the selected report image file
            const [reportImagePreview, setReportImagePreview] = useState(null); // URL for image preview

            // Form data state for user's biodata
            const [formData, setFormData] = useState({
                fullName: '', dob: '', gender: 'Male', phone: '', location: '',
                height: '', weight: '', bloodGroup: '', allergies: '', chronicDiseases: '', pastMedicalHistory: '',
                smokingStatus: 'Never', alcoholConsumption: '', dietaryHabits: '', exercise: '', sleepHours: '', stressLevel: 'Low',
            });

            // --- Firebase Configuration ---
            // Parse Firebase config and app ID from global window variables provided by Canvas
            const firebaseConfig = JSON.parse(window.__firebase_config);
            const appId = window.__app_id;
            const initialAuthToken = window.__initial_auth_token;

            // --- Helper Function for Notifications ---
            const showNotification = (message, type = 'success') => {
                setNotification({ show: true, message, type });
                // Hide notification after 3 seconds
                setTimeout(() => setNotification({ show: false, message: '', type: '' }), 3000);
            };

            // --- Helper Function to convert File to Base64 ---
            const fileToBase64 = (file) => new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file); // Read the file as a data URL
                reader.onload = () => resolve(reader.result.split(',')[1]); // Resolve with the base64 string (remove data URL prefix)
                reader.onerror = error => reject(error); // Reject on error
            });

            // --- Firebase Initialization and Authentication Logic ---
            useEffect(() => {
                try {
                    // Initialize Firebase app, auth, and firestore instances
                    const app = initializeApp(firebaseConfig);
                    const authInstance = getAuth(app);
                    const dbInstance = getFirestore(app);
                    setLogLevel('debug'); // Enable Firebase debug logging for more verbose console output
                    setAuth(authInstance);
                    setDb(dbInstance);

                    // Listen for authentication state changes
                    const unsubscribe = onAuthStateChanged(authInstance, async (user) => {
                        if (user) {
                            // If user is logged in, set their UID
                            setUserId(user.uid);
                        } else {
                            // If no user, try to sign in with custom token if available, otherwise anonymously
                            if (initialAuthToken) {
                                await signInWithCustomToken(authInstance, initialAuthToken);
                            } else {
                                await signInAnonymously(authInstance);
                            }
                        }
                        setIsAuthReady(true); // Mark authentication as ready
                    });
                    return () => unsubscribe(); // Clean up auth state listener on component unmount
                } catch (error) {
                    console.error("Firebase initialization failed:", error);
                    showNotification('Could not connect to services. Check API key and network.', 'error');
                }
            }, [firebaseConfig, initialAuthToken]); // Rerun if config or token changes

            // --- Data Fetching from Firestore ---
            // Memoized callback to fetch user data from Firestore
            const fetchUserData = useCallback(async () => {
                if (!isAuthReady || !db || !userId) return; // Only fetch if auth is ready, db exists, and user ID is available
                // Construct Firestore document reference
                const userDocRef = doc(db, 'artifacts', appId, 'users', userId, 'biodata', 'profile');
                try {
                    const docSnap = await getDoc(userDocRef); // Get the document snapshot
                    if (docSnap.exists()) {
                        // If document exists, update form data with fetched data
                        setFormData(prevData => ({ ...prevData, ...docSnap.data() }));
                    } else {
                        // If document doesn't exist, log a message (it will be created on first save)
                        console.log("No existing biodata found for this user.");
                    }
                } catch (error) {
                    console.error("Error fetching user data:", error);
                    showNotification('Failed to load your profile.', 'error');
                }
            }, [db, userId, isAuthReady, appId]); // Rerun if db, userId, authReady, or appId changes

            // Effect to call fetchUserData when dependencies change
            useEffect(() => {
                fetchUserData();
            }, [fetchUserData]);

            // --- Event Handlers ---
            // Handles changes in form input fields
            const handleInputChange = (e) => setFormData(prev => ({ ...prev, [e.target.name]: e.target.value }));

            // Handles form submission to save biodata to Firestore
            const handleFormSubmit = async (e) => {
                e.preventDefault(); // Prevent default form submission behavior
                if (!db || !userId) { 
                    showNotification('Cannot save. Service not ready or user not authenticated.', 'error'); 
                    return; 
                }
                const userDocRef = doc(db, 'artifacts', appId, 'users', userId, 'biodata', 'profile');
                try {
                    // Set document data, merging with existing data
                    await setDoc(userDocRef, formData, { merge: true });
                    showNotification('Profile saved successfully!', 'success');
                } catch (error) {
                    console.error("Error saving profile:", error);
                    showNotification('Failed to save profile. Please try again.', 'error');
                }
            };

            // Handles user login
            const handleLogin = async () =>{

            }

            // Handles user logout
            const handleLogout = async () => {
                if (!auth) return;
                try {
                    await signOut(auth); // Sign out the current user
                    setUserId(null); // Clear user ID
                    // Reset form data to initial empty state
                    setFormData({ fullName: '', dob: '', gender: 'Male', phone: '', location: '', height: '', weight: '', bloodGroup: '', allergies: '', chronicDiseases: '', pastMedicalHistory: '', smokingStatus: 'Never', alcoholConsumption: '', dietaryHabits: '', exercise: '', sleepHours: '', stressLevel: 'Low' });
                    showNotification('You have been logged out.', 'success');
                } catch (error) {
                    console.error("Logout failed:", error);
                    showNotification('Logout failed. Please try again.', 'error');
                }
            };

            // Handles generation of health summary using Gemini API
            const handleGenerateSummary = async () => {
                if (!formData.height || !formData.weight) { 
                    showNotification('Please provide at least height and weight to generate a summary.', 'error'); 
                    return; 
                }
                setIsSummaryLoading(true); // Set loading state
                setHealthSummary(''); // Clear previous summary
                // Construct prompt for health summary generation
                const prompt = `Analyze this health data: ${JSON.stringify(formData)}. Provide a personalized health summary. Cover BMI, lifestyle, reminders for conditions/allergies, and 3 actionable tips. Start with '<h3>Your Personalized Health Summary:</h3>'. End with '<b>Disclaimer: Not medical advice. Consult a doctor.</b>'. Use HTML for lists.`;
                try {
                    const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                    const payload = { contents: chatHistory };
                    const apiKey = ""; // Canvas provides API key
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, { 
                        method: 'POST', 
                        headers: { 'Content-Type': 'application/json' }, 
                        body: JSON.stringify(payload) 
                    });
                    const result = await response.json();
                    if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                        setHealthSummary(result.candidates[0].content.parts[0].text);
                    } else { 
                        setHealthSummary('<p class="text-red-500">Could not generate summary. No response from AI.</p>'); 
                    }
                } catch (error) {
                    console.error("Summary generation error:", error);
                    setHealthSummary('<p class="text-red-500">An error occurred during summary generation. Please try again.</p>');
                } finally { 
                    setIsSummaryLoading(false); // Reset loading state
                }
            };

            // Handles file selection for report image
            const handleReportFileChange = (e) => {
                const file = e.target.files[0];
                // Validate file type (image) and size (max 10MB)
                if (file && file.type.startsWith('image/') && file.size <= 10 * 1024 * 1024) { 
                    setReportImage(file);
                    setReportImagePreview(URL.createObjectURL(file)); // Create a URL for image preview
                } else {
                    showNotification('Please upload a valid image file (PNG, JPG, up to 10MB).', 'error');
                    setReportImage(null);
                    setReportImagePreview(null);
                }
            };

            // Handles analysis of uploaded medical report using Gemini API (Image Understanding)
            const handleAnalyzeReport = async () => {
                if (!reportImage) { 
                    showNotification('Please upload a report image first to analyze.', 'error'); 
                    return; 
                }
                setIsReportLoading(true); // Set loading state
                setReportAnalysis(''); // Clear previous analysis
                try {
                    const base64ImageData = await fileToBase64(reportImage); // Convert image to base64
                    // Construct prompt for image analysis
                    const prompt = "You are a helpful medical assistant. Analyze the provided medical report image. Extract key metrics, their values, and their standard ranges. Provide a simple, easy-to-understand summary of the results. Do not provide a diagnosis. Conclude with '<h4>Summary</h4>' for the summary and a strong disclaimer in bold: '<b>This is not a medical diagnosis. Always consult a licensed healthcare professional for any health concerns.</b>'. Format the output using simple HTML with '<ul>' and '<li>' for lists.";

                    const payload = {
                        contents: [{ role: "user", parts: [{ text: prompt }, { inlineData: { mimeType: reportImage.type, data: base64ImageData } }] }],
                    };
                    const apiKey = ""; // Canvas provides API key
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, { 
                        method: 'POST', 
                        headers: { 'Content-Type': 'application/json' }, 
                        body: JSON.stringify(payload) 
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                        setReportAnalysis(result.candidates[0].content.parts[0].text);
                    } else { 
                        setReportAnalysis('<p class="text-red-500">Could not analyze the report. No response from AI.</p>'); 
                    }
                } catch (error) {
                    console.error("Report analysis error:", error);
                    setReportAnalysis('<p class="text-red-500">An error occurred during analysis. Please try again.</p>');
                } finally { 
                    setIsReportLoading(false); // Reset loading state
                }
            };

            // Tailwind CSS classes for consistent input and label styling
            const inputClasses = "w-full p-3 bg-gray-50 rounded-lg mt-1 border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all duration-200";
            const labelClasses = "block text-gray-700 font-semibold mb-1";
            const buttonPrimaryClasses = "bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-4 focus:ring-blue-300";
            const buttonSecondaryClasses = "bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-full shadow-md transition transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-4 focus:ring-gray-300";


            return (
                <div className="min-h-screen bg-slate-50 text-gray-800 antialiased">
                    {/* Notification Pop-up */}
                    <Notification {...notification} />

                    {/* AI Chatbot Button */}
                    <button
                        onClick={() => setIsChatbotVisible(true)}
                        className="fixed bottom-5 right-5 bg-gradient-to-r from-blue-600 to-indigo-700 text-white rounded-full w-16 h-16 flex items-center justify-center shadow-xl z-20 hover:bg-blue-700 transition-all duration-300 transform hover:scale-110 focus:outline-none focus:ring-4 focus:ring-blue-300"
                        aria-label="Open AI Chatbot"
                    >
                        {/* Chat icon (SVG) */}
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg>
                    </button>

                    {/* AI Chatbot Component */}
                    <AiChatbot biodata={formData} isVisible={isChatbotVisible} onClose={() => setIsChatbotVisible(false)} />

                    {/* Header Section */}
                    <header className="bg-white shadow-md fixed w-full top-0 left-0 z-10">
                        <div className="container mx-auto px-4 py-4 flex justify-between items-center">
                            <h1 className="text-3xl sm:text-4xl font-bold text-blue-600">Health <span className="text-green-500">Yaar</span></h1>
                            {/* Desktop Navigation */}
                            <nav className="hidden md:flex space-x-6 lg:space-x-8 items-center">
                                <a href="#features" className="text-gray-600 hover:text-blue-600 font-semibold transition duration-200">Features</a>
                                <a href="#biodata-form" className="text-gray-600 hover:text-blue-600 font-semibold transition duration-200">Profile</a>
                                <a href="#report-analysis" className="text-gray-600 hover:text-blue-600 font-semibold transition duration-200">Analysis</a>
                                { isAuthReady && userId && (
                                    <button
                                        onClick={handleLogout}
                                        className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full shadow-lg transition transform hover:scale-105"
                                    >
                                        Logout
                                    </button>
                                )}
                                <button
                                    className="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full shadow-lg transition transform hover:scale-105"
                                >
                                    SOS
                                </button>
                            </nav>
                            {/* Mobile Menu Icon (Hamburger) */}
                            <button className="md:hidden text-gray-600 text-3xl focus:outline-none">
                                &#9776; {/* Hamburger icon */}
                            </button>
                        </div>
                    </header>

                    {/* Hero Section */}
                    <section
                        className="pt-32 pb-20 text-white flex items-center justify-center min-h-[50vh] px-4 md:px-6 relative overflow-hidden"
                        style={{background: 'linear-gradient(-45deg, #e0f2fe, #bfdbfe, #a5b4fc, #818cf8)', backgroundSize: '400% 400%', animation: 'gradient 15s ease infinite'}}
                    >
                        <div className="container mx-auto text-center z-10">
                            <h2 className="text-4xl sm:text-5xl md:text-6xl font-bold mb-4 leading-tight drop-shadow-lg">
                                Your Personal <span className="text-green-500 bg-white bg-opacity-20 px-2 py-1 rounded-lg">Health</span> Companion
                            </h2>
                            <p className="text-lg sm:text-xl mb-8 max-w-3xl mx-auto drop-shadow-md">
                                Now with AI-powered insights to help you on your wellness journey.
                            </p>
                            {/* Optionally add a call to action button */}
                            <a href="#biodata-form" className={`${buttonPrimaryClasses} text-lg`}>Get Started</a>
                        </div>
                    </section>

                    {/* Features Section */}
                    <section id="features" className="py-16 md:py-20 bg-white">
                        <div className="container mx-auto px-4 md:px-6">
                            <h3 className="text-3xl sm:text-4xl font-bold text-center mb-10 md:mb-16 text-blue-800">
                                Our Innovative <span className="text-green-500">Health</span> Features
                            </h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 md:gap-10">
                                {[
                                    { title: "User's Biodata", desc: "Securely store your personal, health, and lifestyle information. Manage your vital stats and medical history effortlessly." },
                                    { title: "✨ AI Doctor Chatbot", desc: "Get instant, general answers to your health queries with our intelligent AI assistant. Your privacy is always protected." },
                                    { title: "✨ Health Summary", desc: "Generate a personalized health summary and actionable tips based on your profile data. Understand your wellness at a glance." },
                                    { title: "✨ Report Analysis", desc: "Upload an image of a medical report for an AI-powered summary of key metrics and their implications. No diagnosis provided." },
                                    { title: "Personal Doctor", desc: "Connect with certified doctors for virtual consultations and personalized medical advice. (Coming Soon)" },
                                    { title: "Group Chat", desc: "Join vibrant health communities to share experiences, gain support, and discuss wellness topics with peers. (Coming Soon)" }
                                ].map((f, index) => (
                                    <div key={index} className="bg-gray-50 p-6 sm:p-8 rounded-xl shadow-lg transition-all duration-300 transform hover:-translate-y-2 hover:shadow-2xl border border-gray-100 flex flex-col justify-between">
                                        <h4 className="text-xl sm:text-2xl font-bold mb-3 text-blue-700" dangerouslySetInnerHTML={{ __html: f.title }}></h4>
                                        <p className="text-gray-600 text-base leading-relaxed" dangerouslySetInnerHTML={{ __html: f.desc.replace(/health/gi, '<span class="text-green-500 font-semibold">health</span>') }}></p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </section>

                    {/* Biodata Form Section */}
                    <section id="biodata-form" className="bg-gray-100 py-16 md:py-20">
                        <div className="container mx-auto px-4 md:px-6">
                            <div className="max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-xl shadow-2xl border border-gray-200">
                                <form onSubmit={handleFormSubmit}>
                                    <h3 className="text-3xl sm:text-4xl font-bold text-center mb-2 text-blue-800">Create Your <span className="text-green-500">Health</span> Profile</h3>
                                    {userId && <p className="text-center text-gray-500 mb-8 text-sm md:text-base break-all">User ID: {userId}</p>}

                                    <div className="mb-10">
                                        <h4 className="text-xl sm:text-2xl font-bold border-b-2 border-blue-200 pb-2 mb-6 text-blue-700">A: Personal Information</h4>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                                            <div>
                                                <label htmlFor="fullName" className={labelClasses}>Full Name</label>
                                                <input type="text" id="fullName" name="fullName" value={formData.fullName} onChange={handleInputChange} className={inputClasses} required />
                                            </div>
                                            <div>
                                                <label htmlFor="dob" className={labelClasses}>Date of Birth</label>
                                                <input type="date" id="dob" name="dob" value={formData.dob} onChange={handleInputChange} className={inputClasses} />
                                            </div>
                                            <div>
                                                <label htmlFor="gender" className={labelClasses}>Gender</label>
                                                <select id="gender" name="gender" value={formData.gender} onChange={handleInputChange} className={inputClasses}>
                                                    <option>Male</option>
                                                    <option>Female</option>
                                                    <option>Other</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label htmlFor="phone" className={labelClasses}>Phone Number</label>
                                                <input type="tel" id="phone" name="phone" value={formData.phone} onChange={handleInputChange} className={inputClasses} />
                                            </div>
                                            <div className="md:col-span-2">
                                                <label htmlFor="location" className={labelClasses}>Location</label>
                                                <input type="text" id="location" name="location" value={formData.location} onChange={handleInputChange} className={inputClasses} />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="mb-10">
                                        <h4 className="text-xl sm:text-2xl font-bold border-b-2 border-green-200 pb-2 mb-6 text-green-700">B: Health Information</h4>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                                            <div>
                                                <label htmlFor="height" className={labelClasses}>Height (cm)</label>
                                                <input type="number" id="height" name="height" value={formData.height} onChange={handleInputChange} className={inputClasses} />
                                            </div>
                                            <div>
                                                <label htmlFor="weight" className={labelClasses}>Weight (kg)</label>
                                                <input type="number" id="weight" name="weight" value={formData.weight} onChange={handleInputChange} className={inputClasses} />
                                            </div>
                                            <div>
                                                <label htmlFor="bloodGroup" className={labelClasses}>Blood Group</label>
                                                <input type="text" id="bloodGroup" name="bloodGroup" value={formData.bloodGroup} onChange={handleInputChange} className={inputClasses} />
                                            </div>
                                            <div>
                                                <label htmlFor="allergies" className={labelClasses}>Known Allergies</label>
                                                <input type="text" id="allergies" name="allergies" value={formData.allergies} onChange={handleInputChange} className={inputClasses} />
                                            </div>
                                            <div className="md:col-span-2">
                                                <label htmlFor="chronicDiseases" className={labelClasses}>Chronic Diseases</label>
                                                <input type="text" id="chronicDiseases" name="chronicDiseases" value={formData.chronicDiseases} onChange={handleInputChange} className={inputClasses} />
                                            </div>
                                            <div className="md:col-span-2">
                                                <label htmlFor="pastMedicalHistory" className={labelClasses}>Past Medical History</label>
                                                <textarea id="pastMedicalHistory" name="pastMedicalHistory" value={formData.pastMedicalHistory} onChange={handleInputChange} rows="3" className={`${inputClasses} resize-y`}></textarea>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="mb-10">
                                        <h4 className="text-xl sm:text-2xl font-bold border-b-2 border-orange-200 pb-2 mb-6 text-orange-700">C: Lifestyle Information</h4>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                                            <div>
                                                <label htmlFor="smokingStatus" className={labelClasses}>Smoking Status</label>
                                                <select id="smokingStatus" name="smokingStatus" value={formData.smokingStatus} onChange={handleInputChange} className={inputClasses}>
                                                    <option>Never</option>
                                                    <option>Current Smoker</option>
                                                    <option>Former Smoker</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label htmlFor="alcoholConsumption" className={labelClasses}>Alcohol Consumption</label>
                                                <input type="text" id="alcoholConsumption" name="alcoholConsumption" value={formData.alcoholConsumption} onChange={handleInputChange} className={inputClasses} />
                                            </div>
                                            <div>
                                                <label htmlFor="dietaryHabits" className={labelClasses}>Dietary Habits</label>
                                                <textarea id="dietaryHabits" name="dietaryHabits" value={formData.dietaryHabits} onChange={handleInputChange} rows="3" className={`${inputClasses} resize-y`}></textarea>
                                            </div>
                                            <div>
                                                <label htmlFor="exercise" className={labelClasses}>Exercise Habits</label>
                                                <textarea id="exercise" name="exercise" value={formData.exercise} onChange={handleInputChange} rows="3" className={`${inputClasses} resize-y`}></textarea>
                                            </div>
                                            <div>
                                                <label htmlFor="sleepHours" className={labelClasses}>Average Sleep Hours</label>
                                                <input type="number" id="sleepHours" name="sleepHours" value={formData.sleepHours} onChange={handleInputChange} className={inputClasses} min="0" max="24" />
                                            </div>
                                            <div>
                                                <label htmlFor="stressLevel" className={labelClasses}>Stress Level</label>
                                                <select id="stressLevel" name="stressLevel" value={formData.stressLevel} onChange={handleInputChange} className={inputClasses}>
                                                    <option>Low</option>
                                                    <option>Medium</option>
                                                    <option>High</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="text-center mt-10">
                                        <button type="submit" className={buttonPrimaryClasses}>
                                            Save Profile
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </section>

                    {/* Health Summary Section */}
                    <section id="health-summary" className="py-16 md:py-20 bg-white">
                        <div className="container mx-auto px-4 md:px-6">
                            <div className="max-w-4xl mx-auto bg-gray-50 p-6 sm:p-8 rounded-xl shadow-2xl border border-gray-200">
                                <h3 className="text-3xl sm:text-4xl font-bold text-center mb-8 text-blue-800">
                                    Generate Your <span className="text-green-500">Health</span> Summary
                                </h3>
                                <div className="text-center mb-6">
                                    <button onClick={handleGenerateSummary} disabled={isSummaryLoading || !isAuthReady || !userId} className={`${buttonPrimaryClasses} ${isSummaryLoading ? 'opacity-60 cursor-not-allowed' : ''}`}>
                                        {isSummaryLoading ? 'Generating...' : 'Generate Summary'}
                                    </button>
                                </div>
                                {healthSummary && (
                                    <div className="mt-8 p-6 bg-white rounded-lg shadow-inner border border-gray-200 overflow-x-auto">
                                        <div dangerouslySetInnerHTML={{ __html: healthSummary }} className="prose max-w-none text-gray-700"></div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </section>

                    {/* Report Analysis Section */}
                    <section id="report-analysis" className="py-16 md:py-20 bg-gray-100">
                        <div className="container mx-auto px-4 md:px-6">
                            <div className="max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-xl shadow-2xl border border-gray-200">
                                <h3 className="text-3xl sm:text-4xl font-bold text-center mb-8 text-blue-800">
                                    AI <span className="text-green-500">Medical Report</span> Analysis
                                </h3>
                                <div className="space-y-6">
                                    <div>
                                        <label htmlFor="reportUpload" className={labelClasses}>Upload Medical Report Image (PNG/JPG, max 10MB)</label>
                                        <input type="file" id="reportUpload" accept="image/png, image/jpeg" onChange={handleReportFileChange} className="w-full text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 transition duration-200" />
                                    </div>
                                    {reportImagePreview && (
                                        <div className="mt-4 text-center">
                                            <img src={reportImagePreview} alt="Report Preview" className="max-w-full h-auto mx-auto rounded-lg shadow-md border border-gray-200" style={{ maxHeight: '400px' }} />
                                            <p className="text-gray-500 text-sm mt-2">Image Preview</p>
                                        </div>
                                    )}
                                    <div className="text-center">
                                        <button onClick={handleAnalyzeReport} disabled={isReportLoading || !reportImage || !isAuthReady || !userId} className={`${buttonPrimaryClasses} ${isReportLoading || !reportImage ? 'opacity-60 cursor-not-allowed' : ''}`}>
                                            {isReportLoading ? 'Analyzing...' : 'Analyze Report'}
                                        </button>
                                    </div>
                                </div>
                                {reportAnalysis && (
                                    <div className="mt-8 p-6 bg-gray-50 rounded-lg shadow-inner border border-gray-200 overflow-x-auto">
                                        <div dangerouslySetInnerHTML={{ __html: reportAnalysis }} className="prose max-w-none text-gray-700"></div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </section>

                    {/* Footer */}
                    <footer className="bg-gray-800 text-white py-8">
                        <div className="container mx-auto px-4 text-center text-sm">
                            <p>&copy; 2025 Health Yaar. All rights reserved.</p>
                            <p className="mt-2">Designed with <span className="text-red-500">&hearts;</span> for your wellness.</p>
                            {userId && <p className="mt-2 text-xs">Current User ID: {userId}</p>}
                        </div>
                    </footer>
                </div>
            );
        };

        // Render the main App component into the 'root' div
        ReactDOM.createRoot(document.getElementById('root')).render(
            <React.StrictMode>
                <App />
            </React.StrictMode>
        );
    </script>
</body>
</html>
